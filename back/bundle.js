!function e(t,r,n){function o(a,c){if(!r[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return o(r?r:e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";var n=function(){function e(){this.rutReceptor="",this.razonReceptor="",this.isErr=!1}return e.prototype.leerTimbre=function(e){var t=new DOMParser;try{var r=t.parseFromString(e,"application/xml");this.rutEmisor=r.getElementsByTagName("RE")[0].innerHTML,this.razonEmisor=r.getElementsByTagName("RS")[0].innerHTML,this.rutReceptor=r.getElementsByTagName("RR")[0].innerHTML,this.razonReceptor=r.getElementsByTagName("RSR")[0].innerHTML,this.folio=parseInt(r.getElementsByTagName("F")[0].innerHTML),this.fechaEmision=new Date(r.getElementsByTagName("TSTED")[0].innerHTML),this.fechaDocumento=r.getElementsByTagName("FE")[0].innerHTML,this.tipoDTE=parseInt(r.getElementsByTagName("TD")[0].innerHTML)}catch(e){this.isErr=!0}},e.prototype.getNombreArchivo=function(e){return this.isErr?"DocumentoTributario":o[this.tipoDTE]+"."+this.fechaDocumento+"."+("000000"+this.folio).slice(-6)+"."+(e?e:this.razonReceptor)},e}();r.timbreElectronico=n,function(e){e[e.FactElec=33]="FactElec",e[e.FactExenta=34]="FactExenta",e[e.FactCompra=46]="FactCompra",e[e.GuiadeDespElect=52]="GuiadeDespElect",e[e.NotadeDebElect=56]="NotadeDebElect",e[e.NotadeCredElect=61]="NotadeCredElect",e[e.LiquiFactElect=43]="LiquiFactElect"}(r.documentosElectronicos||(r.documentosElectronicos={}));var o=r.documentosElectronicos},{}],2:[function(e,t,r){"use strict";function n(e,t){e.tabId=parseInt(e.tabId);var r=new o.timbreElectronico;r.leerTimbre(e.timbreElec);var n=new XMLHttpRequest;n.open("post",i+"OrdenesDeSalida_subirPDFconTimbre"),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onload=function(){t({status:"OK"})},n.onerror=function(){t({status:"ERROR"})},n.upload.onprogress=function(t){t.lengthComputable&&chrome.tabs.sendMessage(e.tabId,{op:"PorcentajeSubidaPDF",valor:t.loaded/t.total})},n.ontimeout=function(){t({status:"TIMEOUT"})},n.send("numorden="+e.numorden+"&pdf="+e.pdf64Base+"&timbre="+btoa(JSON.stringify(r)))}var o=e("./factura-electronica"),i="http://www.almafrigo.cl/webservices/webserviceoperaciones.asmx/";chrome.tabs.onUpdated.addListener(function(e,t,r){0==r.url.indexOf("https://www1.sii.cl/cgi-bin/Portal001/mipeGenFacEx.cgi?")&&chrome.pageAction.show(e)}),chrome.runtime.onMessage.addListener(function(e,t,r){switch(e.op){case"RellenarSIIForm":chrome.tabs.query({active:!0,currentWindow:!0},function(t){0!=t.length&&(e.tabId=t[0].id,chrome.tabs.sendMessage(e.tabId,e))});break;case"QuienSoy":r({tabId:t.tab.id});break;case"SubirPDF":return n(e,r),!0}})},{"./factura-electronica":1}]},{},[2]);
